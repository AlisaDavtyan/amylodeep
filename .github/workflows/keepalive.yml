name: AmyloDeep Keep-Alive (Lightweight)
on:
  schedule:
    - cron: "*/50 * * * *"
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    concurrency:
      group: amylodeep-keepalive
      cancel-in-progress: false
    
    steps:
      - name: Keep Streamlit app alive
        run: |
          APP_URL="https://amylodeep.streamlit.app/?skip_splash=1"
          echo "üöÄ Pinging $APP_URL"
          
          # Make initial request to wake up the app
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
            --connect-timeout 30 \
            --max-time 60 \
            "$APP_URL")
          
          echo "üì° Initial response: $response"
          
          if [ "$response" = "200" ] || [ "$response" = "302" ]; then
            echo "‚úÖ App is responding"
            
            # Wait a bit and ping again to ensure session stays active
            sleep 10
            
            response2=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
              --connect-timeout 15 \
              --max-time 30 \
              "$APP_URL")
            
            echo "üîÑ Second response: $response2"
            echo "‚úÖ Keep-alive completed successfully"
          else
            echo "‚ö†Ô∏è App returned $response but keep-alive attempted"
          fi
